Process flow we executed (end-to-end)

Created a Workload Identity (WI)

We created a standalone workload identity in AgentCore Identity (this is the “who is calling” identity the runtime will use).

Created an Outbound Auth API Key provider

We stored a test API key value in AgentCore Identity as an “API key credential provider” (this represents a third-party credential you’d normally use to call an external API).

Configured the Lambda target (tool handler)

Updated the Lambda code attached to the MCP Gateway so it:

handles tools/list and tools/call

on tools/call, fetches credentials via AgentCore Identity APIs

Set Lambda environment variables:

WORKLOAD_NAME = the workload identity name

APIKEY_PROVIDER_NAME = the API key provider name

Invoked the tool through the MCP Gateway from SageMaker

From the notebook, we called the MCP Gateway URL:

tools/list → confirmed the tool is discoverable

tools/call → triggered the Lambda tool execution

Lambda authenticated to AgentCore Identity and retrieved a credential

Inside Lambda:

called GetWorkloadAccessToken using WORKLOAD_NAME → received a short-lived workloadAccessToken

called GetResourceApiKey using that token + APIKEY_PROVIDER_NAME → retrieved the API key

Lambda returned a success response showing:

inputs (amount/reason)

workload identity name

provider name

masked API key (proof of retrieval without leaking the secret)

Big takeaway (what this proves about AgentCore Identity)

We proved that AgentCore Identity can act as a runtime credential broker: a workload can authenticate as a specific identity, obtain a short-lived token, and use that token to securely retrieve an outbound credential (API key) from a configured provider during tool execution—without hardcoding secrets in code.

In one line:
Gateway tool call → Lambda execution → Identity token issued → credential access authorized → API key retrieved successfully.

Without AgentCore Identity, runtime agents or services would need to store and manage external API credentials directly (for example, in environment variables, configuration files, or code). There would be no workload-level authentication, no short-lived identity tokens, and no runtime authorization checks before accessing protected credentials.

AgentCore Identity introduces a secure control layer: a workload must first authenticate as a registered identity, obtain a short-lived token, and be explicitly authorized before retrieving outbound credentials. This enforces identity-based access control at runtime and eliminates the need to embed long-lived secrets in application logic
