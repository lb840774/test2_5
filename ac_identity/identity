cell1: 
import requests, json, time, uuid, os
import boto3
from botocore.exceptions import ClientError

# Paste your existing Gateway MCP endpoint (you already have this)
GATEWAY_URL = "https://poc-refund-test-jkvxhvn06a.gateway.bedrock-agentcore.us-east-1.amazonaws.com/mcp"

# Paste your Gateway ARN (from console or list call in AWS)
GATEWAY_ARN = "PASTE_YOUR_GATEWAY_ARN_HERE"

REGION = os.environ.get("AWS_REGION", "us-east-1")
sess = boto3.session.Session(region_name=REGION)
ctrl = sess.client("bedrock-agentcore-control")

def mcp(method, params=None, _id=1):
    payload = {"jsonrpc":"2.0", "id": _id, "method": method}
    if params is not None:
        payload["params"] = params
    r = requests.post(GATEWAY_URL, json=payload, timeout=30)
    print("HTTP", r.status_code)
    r.raise_for_status()
    return r.json()

print("Region:", REGION)
print("Gateway ARN:", GATEWAY_ARN)

cell2:
tools_resp = mcp("tools/list", _id=1)
print(json.dumps(tools_resp, indent=2)[:2000])

cell3:
import uuid, time, json
from botocore.exceptions import ClientError

API_KEY_VALUE = "demo-secret"

try:
    resp = ctrl.create_api_key_credential_provider(
        name=f"demo-apikey-{uuid.uuid4().hex[:8]}",
        apiKey=API_KEY_VALUE
    )

    print("RAW RESPONSE:")
    print(json.dumps(resp, indent=2, default=str))

    # Try common locations for the ARN (handles SDK/shape differences)
    APIKEY_PROVIDER_ARN = (
        resp.get("apiKeyCredentialProviderArn")
        or resp.get("apiKeyCredentialProviderARN")
        or resp.get("credentialProviderArn")
        or resp.get("arn")
        or (resp.get("apiKeyCredentialProvider") or {}).get("arn")
        or (resp.get("apiKeyCredentialProvider") or {}).get("apiKeyCredentialProviderArn")
    )

    if not APIKEY_PROVIDER_ARN:
        raise KeyError(f"Could not find provider ARN in response keys: {list(resp.keys())}")

    print("\n✅ APIKEY_PROVIDER_ARN:", APIKEY_PROVIDER_ARN)

except ClientError as e:
    print("❌ AWS ClientError:")
    print(e.response["Error"]["Code"], "-", e.response["Error"].get("Message"))
    raise

cell4:
import json

# dp = sess.client("bedrock-agentcore")  # you already created this earlier

api_key_resp = dp.get_resource_api_key(
    resourceArn=APIKEY_PROVIDER_ARN
)

print("RAW get_resource_api_key response:")
print(json.dumps(api_key_resp, indent=2, default=str))

API_KEY_FROM_IDENTITY = (
    api_key_resp.get("apiKey")
    or api_key_resp.get("value")
    or (api_key_resp.get("resourceApiKey") or {}).get("apiKey")
    or (api_key_resp.get("resourceApiKey") or {}).get("value")
)

if not API_KEY_FROM_IDENTITY:
    raise KeyError(f"Could not find apiKey value in response keys: {list(api_key_resp.keys())}")

print("\n✅ API_KEY_FROM_IDENTITY:", API_KEY_FROM_IDENTITY)

cell5:
import requests, json

r = requests.get(
    "https://httpbin.org/headers",
    headers={"x-api-key": API_KEY_FROM_IDENTITY},
    timeout=30
)

print("HTTP:", r.status_code)
data = r.json()
print(json.dumps(data, indent=2)[:2000])

# Proof
echoed = data.get("headers", {}).get("X-Api-Key")
print("\n✅ Echoed X-Api-Key:", echoed)











import boto3, os, inspect

REGION = os.environ.get("AWS_REGION", "us-east-1")
sess = boto3.session.Session(region_name=REGION)

ctrl = sess.client("bedrock-agentcore-control")
dp   = sess.client("bedrock-agentcore")  # data-plane-ish client in many setups

def show_methods(client, contains):
    methods = [m for m in dir(client) if contains in m.lower()]
    print(client.meta.service_model.service_name, "->", methods)

show_methods(ctrl, "api")
show_methods(ctrl, "key")
show_methods(dp, "api")
show_methods(dp, "key")

